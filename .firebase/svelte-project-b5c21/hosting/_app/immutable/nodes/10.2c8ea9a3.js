import{s as le,v as K,p as W,e as X,g as w,c as U,h as C,i as B,d as V,C as E,k as T,M as Z,J as ae,K as oe,l as A,m as P,B as z}from"../chunks/scheduler.d83c174e.js";import{S as ue,i as ce,d as R,v as fe,j as re,k as me,m as de,b as he,t as _e,l as pe,a as y,e as b,g as k,n as g,p as O,s as L}from"../chunks/index.6e71aa37.js";import{A as $}from"../chunks/AuthCheck.cd7075c0.js";import{d as j,u as I,a as q,h as N,p as G,t as H}from"../chunks/firebase.dfe6b682.js";const be=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{console:ge}=be,S="src/routes/login/username/+page.svelte";function ee(n){let e,t,u,i,a,s,l,c,D,f=n[1]&&n[5]&&n[3]&&M(n),m=!n[3]&&n[5]&&Q(n),d=n[3]&&!n[2]&&!n[1]&&Y(n),h=n[3]&&n[2]&&!n[1]&&F(n);const v={c:function(){e=w("form"),t=w("input"),u=U(),i=w("div"),f&&f.c(),a=U(),m&&m.c(),s=U(),d&&d.c(),l=U(),h&&h.c(),this.h()},l:function(o){e=C(o,"FORM",{class:!0});var p=B(e);t=C(p,"INPUT",{type:!0,placeholder:!0,class:!0}),u=V(p),i=C(p,"DIV",{class:!0});var r=B(i);f&&f.l(r),a=V(r),m&&m.l(r),s=V(r),d&&d.l(r),l=V(r),h&&h.l(r),r.forEach(b),p.forEach(b),this.h()},h:function(){k(t,"type","text"),k(t,"placeholder","Username"),k(t,"class","input w-full"),E(t,"input-error",!n[3]&&n[5]),E(t,"input-warning",n[4]),E(t,"input-success",n[3]&&n[2]&&!n[1]),T(t,S,64,12,1842),k(i,"class","my-4 min-h-16 px-8 w-full"),T(i,S,75,12,2253),k(e,"class","w-2/5"),T(e,S,63,8,1766)},m:function(o,p){y(o,e,p),g(e,t),Z(t,n[0]),g(e,u),g(e,i),f&&f.m(i,null),g(i,a),m&&m.m(i,null),g(i,s),d&&d.m(i,null),g(i,l),h&&h.m(i,null),c||(D=[O(t,"input",n[9]),O(t,"input",n[7],!1,!1,!1,!1),O(e,"submit",ae(n[8]),!1,!0,!1,!1)],c=!0)},p:function(o,p){p&1&&t.value!==o[0]&&Z(t,o[0]),p&40&&E(t,"input-error",!o[3]&&o[5]),p&16&&E(t,"input-warning",o[4]),p&14&&E(t,"input-success",o[3]&&o[2]&&!o[1]),o[1]&&o[5]&&o[3]?f?f.p(o,p):(f=M(o),f.c(),f.m(i,a)):f&&(f.d(1),f=null),!o[3]&&o[5]?m||(m=Q(o),m.c(),m.m(i,s)):m&&(m.d(1),m=null),o[3]&&!o[2]&&!o[1]?d?d.p(o,p):(d=Y(o),d.c(),d.m(i,l)):d&&(d.d(1),d=null),o[3]&&o[2]&&!o[1]?h?h.p(o,p):(h=F(o),h.c(),h.m(i,null)):h&&(h.d(1),h=null)},d:function(o){o&&b(e),f&&f.d(),m&&m.d(),d&&d.d(),h&&h.d(),c=!1,oe(D)}};return R("SvelteRegisterBlock",{block:v,id:ee.name,type:"else",source:"(55:4) {:else}",ctx:n}),v}function te(n){let e,t,u,i,a=n[6].username+"",s,l,c,D="(Usernames cannot be changed)",f,m,d="Upload Profile Image";const h={c:function(){e=w("p"),t=A("Your username is "),u=w("span"),i=A("@"),s=A(a),l=U(),c=w("p"),c.textContent=D,f=U(),m=w("a"),m.textContent=d,this.h()},l:function(_){e=C(_,"P",{class:!0});var o=B(e);t=P(o,"Your username is "),u=C(o,"SPAN",{class:!0});var p=B(u);i=P(p,"@"),s=P(p,a),p.forEach(b),o.forEach(b),l=V(_),c=C(_,"P",{class:!0,"data-svelte-h":!0}),z(c)!=="svelte-9l80or"&&(c.textContent=D),f=V(_),m=C(_,"A",{class:!0,href:!0,"data-svelte-h":!0}),z(m)!=="svelte-1ynqfz"&&(m.textContent=d),this.h()},h:function(){k(u,"class","font-bold text-green-400"),T(u,S,58,29,1519),k(e,"class","text-lg"),T(e,S,57,8,1470),k(c,"class","text-sm"),T(c,S,60,8,1608),k(m,"class","btn btn-primary mt-3"),k(m,"href","/login/photo"),T(m,S,61,8,1669)},m:function(_,o){y(_,e,o),g(e,t),g(e,u),g(u,i),g(u,s),y(_,l,o),y(_,c,o),y(_,f,o),y(_,m,o)},p:function(_,o){o&64&&a!==(a=_[6].username+"")&&L(s,a)},d:function(_){_&&(b(e),b(l),b(c),b(f),b(m))}};return R("SvelteRegisterBlock",{block:h,id:te.name,type:"if",source:"(49:4) {#if $userData?.username}",ctx:n}),h}function M(n){let e,t,u,i;const a={c:function(){e=w("p"),t=A("Checking availability of @"),u=A(n[0]),i=A("..."),this.h()},l:function(l){e=C(l,"P",{class:!0});var c=B(e);t=P(c,"Checking availability of @"),u=P(c,n[0]),i=P(c,"..."),c.forEach(b),this.h()},h:function(){k(e,"class","text-secondary"),T(e,S,77,20,2367)},m:function(l,c){y(l,e,c),g(e,t),g(e,u),g(e,i)},p:function(l,c){c&1&&L(u,l[0])},d:function(l){l&&b(e)}};return R("SvelteRegisterBlock",{block:a,id:M.name,type:"if",source:"(69:16) {#if loading && isTouched && isValid}",ctx:n}),a}function Q(n){let e,t="must be 3-16 characters long, alphanumeric only";const u={c:function(){e=w("p"),e.textContent=t,this.h()},l:function(a){e=C(a,"P",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-15rk0xx"&&(e.textContent=t),this.h()},h:function(){k(e,"class","text-error text-sm"),T(e,S,81,20,2536)},m:function(a,s){y(a,e,s)},d:function(a){a&&b(e)}};return R("SvelteRegisterBlock",{block:u,id:Q.name,type:"if",source:"(73:16) {#if !isValid && isTouched}",ctx:n}),u}function Y(n){let e,t,u,i;const a={c:function(){e=w("p"),t=A("@"),u=A(n[0]),i=A(" is not available"),this.h()},l:function(l){e=C(l,"P",{class:!0});var c=B(e);t=P(c,"@"),u=P(c,n[0]),i=P(c," is not available"),c.forEach(b),this.h()},h:function(){k(e,"class","text-warning text-sm"),T(e,S,87,20,2773)},m:function(l,c){y(l,e,c),g(e,t),g(e,u),g(e,i)},p:function(l,c){c&1&&L(u,l[0])},d:function(l){l&&b(e)}};return R("SvelteRegisterBlock",{block:a,id:Y.name,type:"if",source:"(79:16) {#if isValid && !isAvailable && !loading}",ctx:n}),a}function F(n){let e,t,u;const i={c:function(){e=w("button"),t=A("Confirm username @"),u=A(n[0]),this.h()},l:function(s){e=C(s,"BUTTON",{class:!0});var l=B(e);t=P(l,"Confirm username @"),u=P(l,n[0]),l.forEach(b),this.h()},h:function(){k(e,"class","btn btn-success"),T(e,S,93,20,2992)},m:function(s,l){y(s,e,l),g(e,t),g(e,u)},p:function(s,l){l&1&&L(u,s[0])},d:function(s){s&&b(e)}};return R("SvelteRegisterBlock",{block:i,id:F.name,type:"if",source:"(85:16) {#if isValid && isAvailable && !loading}",ctx:n}),i}function ne(n){let e;function t(s,l){var c;return(c=s[6])!=null&&c.username?te:ee}let u=t(n),i=u(n);const a={c:function(){i.c(),e=X()},l:function(l){i.l(l),e=X()},m:function(l,c){i.m(l,c),y(l,e,c)},p:function(l,c){u===(u=t(l))&&i?i.p(l,c):(i.d(1),i=u(l),i&&(i.c(),i.m(e.parentNode,e)))},d:function(l){l&&b(e),i.d(l)}};return R("SvelteRegisterBlock",{block:a,id:ne.name,type:"slot",source:"(48:0) <AuthCheck>",ctx:n}),a}function J(n){let e,t;e=new $({props:{$$slots:{default:[ne]},$$scope:{ctx:n}},$$inline:!0});const u={c:function(){re(e.$$.fragment)},l:function(a){me(e.$$.fragment,a)},m:function(a,s){de(e,a,s),t=!0},p:function(a,[s]){const l={};s&4223&&(l.$$scope={dirty:s,ctx:a}),e.$set(l)},i:function(a){t||(he(e.$$.fragment,a),t=!0)},o:function(a){_e(e.$$.fragment,a),t=!1},d:function(a){pe(e,a)}};return R("SvelteRegisterBlock",{block:u,id:J.name,type:"component",source:"",ctx:n}),u}const x=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function ke(n,e,t){let u,i,a,s,l;K(I,"user"),W(n,I,r=>t(11,s=r)),K(q,"userData"),W(n,q,r=>t(6,l=r));let{$$slots:c={},$$scope:D}=e;fe("Page",c,[]);let f="",m=!1,d=!1,h;async function v(){t(2,d=!1),clearTimeout(h),t(1,m=!0),h=setTimeout(async()=>{console.log("checking availability of",f);const r=N(j,"usernames",f),ie=await G(r).then(se=>se.exists());t(2,d=!ie),t(1,m=!1)},500)}async function _(){console.log("confirming username",f);const r=H(j);r.set(N(j,"usernames",f),{uid:s==null?void 0:s.uid}),r.set(N(j,"users",s.uid),{username:f,photoURL:(s==null?void 0:s.photoURL)??null,published:!0,bio:"Don't sue me, L*nktree",links:[{title:"Sample Link",url:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",icon:"custom"}]}),await r.commit()}const o=[];Object.keys(e).forEach(r=>{!~o.indexOf(r)&&r.slice(0,2)!=="$$"&&r!=="slot"&&ge.warn(`<Page> was created with unknown prop '${r}'`)});function p(){f=this.value,t(0,f)}return n.$capture_state=()=>({AuthCheck:$,db:j,user:I,userData:q,doc:N,getDoc:G,writeBatch:H,username:f,loading:m,isAvailable:d,debounceTimer:h,re:x,checkAvailability:v,confirmUsername:_,isValid:u,isTaken:a,isTouched:i,$user:s,$userData:l}),n.$inject_state=r=>{"username"in r&&t(0,f=r.username),"loading"in r&&t(1,m=r.loading),"isAvailable"in r&&t(2,d=r.isAvailable),"debounceTimer"in r&&(h=r.debounceTimer),"isValid"in r&&t(3,u=r.isValid),"isTaken"in r&&t(4,a=r.isTaken),"isTouched"in r&&t(5,i=r.isTouched)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&1&&t(3,u=(f==null?void 0:f.length)>2&&f.length<16&&x.test(f)),n.$$.dirty&1&&t(5,i=f.length>0),n.$$.dirty&14&&t(4,a=u&&!d&&!m)},[f,m,d,u,a,i,l,v,_,p]}class Te extends ue{constructor(e){super(e),ce(this,e,ke,J,le,{}),R("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:J.name})}}export{Te as component};
